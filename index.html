<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<title>‡πÄ‡∏Å‡∏°‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ä‡∏≤‡∏¢‡∏™‡∏µ‡πà ‡∏õ6/5 ‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏•‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ</title>

<style>

html,body{
margin:0;
height:100%;
overflow:hidden;
font-family:sans-serif;
background:
url("sand.jpg"),
url("brick.png");
background-size:cover;
background-blend-mode:multiply;
}

#splash{
position:fixed;
inset:0;
background:black;
color:white;
display:flex;
align-items:center;
justify-content:center;
z-index:20;
font-size:24px;
}

#top{
text-align:center;
padding:8px;
font-size:18px;
}

#game{
display:grid;
grid-template-columns:repeat(4,1fr);
gap:3vw;
padding:4vw;
height:70vh;
box-sizing:border-box;
}

.card{
aspect-ratio:1/1;
background:#c9a66b;
border-radius:20px;
display:flex;
align-items:center;
justify-content:center;
font-size:12vw;
user-select:none;
}

.open{background:white}

#overlay{
position:fixed;
inset:0;
display:none;
align-items:center;
justify-content:center;
background:rgba(0,0,0,.6);
opacity:0;
transition:.5s;
z-index:10;
}

#overlay.show{opacity:1}

#overlay img{
width:60vw;
max-width:240px;
animation:fade 1.4s;
}

@keyframes fade{
0%{opacity:0}
30%{opacity:1}
70%{opacity:1}
100%{opacity:0}
}

#flash{
position:fixed;
inset:0;
background:white;
opacity:0;
pointer-events:none;
z-index:15;
transition:.3s;
}

</style>
</head>

<body>

<div id="splash">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>

<div id="flash"></div>

<div id="overlay"><img id="overlayImg"></div>

<div id="top">
‚ù§Ô∏è <span id="life">6</span>
‡∏î‡πà‡∏≤‡∏ô <span id="level">1</span>

<select id="mode" onchange="startGame()">
<option value="easy">‡∏á‡πà‡∏≤‡∏¢</option>
<option value="normal">‡∏õ‡∏Å‡∏ï‡∏¥</option>
<option value="hard">‡∏¢‡∏≤‡∏Å</option>
<option value="extreme">‡πÇ‡∏´‡∏î</option>
</select>
</div>

<div id="game"></div>

<script>

setTimeout(()=>splash.style.display="none",1500);

// sounds
const correctSound=new Audio("correct.mp3");
const wrongSound=new Audio("wrong.mp3");
const winSound=new Audio("win.mp3");
const loseSound=new Audio("lose.mp3");
const flashSound=new Audio("flashbang.mp3");

const sounds=[correctSound,wrongSound,winSound,loseSound,flashSound];

function fadeSound(s){
sounds.forEach(x=>{x.pause();x.currentTime=0});
s.volume=1;
s.play();
}

function fadeOut(s){
let i=setInterval(()=>{
s.volume-=0.1;
if(s.volume<=0){
s.pause();
clearInterval(i);
}
},80);
}

const notes=["ùÖù","ùÖû","‚ô©","‚ô™","ùÑª","ùÑº","ùÑΩ","ùÑæ"];
const modes={easy:3,normal:4,hard:6,extreme:8};

let life=6,level=1,first=null,lock=true,match=0;

function vibrate(){navigator.vibrate?.(200);}

function show(img,victory=false){

lock=true;
overlayImg.src=img;
overlay.style.display="flex";
setTimeout(()=>overlay.classList.add("show"),10);

if(victory){
flash.style.opacity=1;
flashSound.play();
setTimeout(()=>flash.style.opacity=0,300);
}

setTimeout(()=>{
overlay.classList.remove("show");
fadeOut(correctSound);
fadeOut(wrongSound);
fadeOut(winSound);
fadeOut(loseSound);
},1200);

setTimeout(()=>{
overlay.style.display="none";
lock=false;
},1600);

}

function startGame(){
life=6;
level=1;
build();
}

function build(){

lock=true;
sounds.forEach(x=>{x.pause();x.currentTime=0});

lifeSpan.innerText=life;
levelSpan.innerText=level;
game.innerHTML="";
first=null;
match=0;

let p=modes[mode.value];
let arr=[];

for(let i=0;i<p;i++)arr.push(notes[i],notes[i]);
arr.sort(()=>Math.random()-0.5);

arr.forEach(n=>{
let c=document.createElement("div");
c.className="card";

c.onclick=()=>{

if(lock||c.classList.contains("open"))return;

c.classList.add("open");
c.innerText=n;

if(!first){first=c;return;}

lock=true;

if(first.innerText===n){

fadeSound(correctSound);
show("win.png");
match++;
first=null;

setTimeout(()=>{
if(match===p){
 if(mode.value==="extreme"){
  fadeSound(winSound);
  show("victory.png",true);
 }else{
  level++;
  fadeSound(winSound);
  build();
 }
}else lock=false;
},1600);

}else{

fadeSound(wrongSound);
show("wrong.png");
vibrate();
life--;
lifeSpan.innerText=life;

setTimeout(()=>{
first.classList.remove("open");
c.classList.remove("open");
first.innerText="";
c.innerText="";
first=null;

if(life<=0){
 fadeSound(loseSound);
 show("lose.png");
}else lock=false;

},1600);

}

};

game.appendChild(c);
});

setTimeout(()=>lock=false,400);
}

const game=document.getElementById("game");
const overlay=document.getElementById("overlay");
const overlayImg=document.getElementById("overlayImg");
const lifeSpan=document.getElementById("life");
const levelSpan=document.getElementById("level");
const mode=document.getElementById("mode");
const splash=document.getElementById("splash");
const flash=document.getElementById("flash");

startGame();

</script>

</body>
</html>
